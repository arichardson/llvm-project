; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --force-update
; RUN: %cheri_opt %s -passes=instcombine -S | FileCheck %s
; This purecap-ABI test case was manually constructed from non-CHERI IR (by
; replacing i8* with i8 addrspace(200)* etc. and changing the datalayout and
; triple) because the test requires that the call to strchr is a direct call
target datalayout = "E-m:e-pf200:128:128:128:64-i8:8:32-i16:16:32-i64:64-n32:64-S128-A200-P200-G200"

@.str = private unnamed_addr addrspace(200) constant [7 x i8] c"#'0- +\00", align 1

define i1 @get_next_format(i32 %arg) #0 {
; CHECK-LABEL: @get_next_format(
; CHECK-NEXT:  entry:
; CHECK-NEXT:    [[TMP0:%.*]] = and i32 [[ARG:%.*]], 255
; CHECK-NEXT:    [[TMP1:%.*]] = zext i32 [[TMP0]] to i64
; CHECK-NEXT:    [[MEMCHR_BOUNDS:%.*]] = icmp ult i32 [[TMP0]], 64
; CHECK-NEXT:    [[TMP2:%.*]] = shl i64 1, [[TMP1]]
; CHECK-NEXT:    [[TMP3:%.*]] = and i64 [[TMP2]], 326043852341249
; CHECK-NEXT:    [[MEMCHR_BITS:%.*]] = icmp ne i64 [[TMP3]], 0
; CHECK-NEXT:    [[MEMCHR1:%.*]] = select i1 [[MEMCHR_BOUNDS]], i1 [[MEMCHR_BITS]], i1 false
; CHECK-NEXT:    ret i1 [[MEMCHR1]]
;
entry:
  %call = call i8 addrspace(200)* @strchr(i8 addrspace(200)* getelementptr inbounds ([7 x i8], [7 x i8] addrspace(200)* @.str, i32 0, i32 0), i32 %arg)
  %tobool = icmp ne i8 addrspace(200)* %call, null
  ret i1 %tobool
}

declare i8 addrspace(200)* @strchr(i8 addrspace(200)*, i32) #1
